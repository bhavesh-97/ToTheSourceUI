<div class="card">
  <div class="flex flex-column gap-4">

    <!-- HEADER -->
    <div class="flex flex-wrap align-items-center justify-content-between gap-3">
      <div style="display:flex; align-items:center; width:100%;">
        <h1 style="margin:0; font-size:1.75rem; font-weight:700;">
          Menu Rights Master
        </h1>

        <div style="margin-left:auto;">
          <div class="d-flex justify-content-lg-end">
            <div class="w-100" style="max-width:250px;">
              <p-iconField iconPosition="left">
                <p-inputIcon>
                  <i class="pi pi-search"></i>
                </p-inputIcon>
                <input
                  pInputText
                  type="text"
                  placeholder="Search Menus..."
                  (input)="onGlobalFilter($event)" />
              </p-iconField>
            </div>
          </div>
        </div>
      </div>

      <!-- FILTER BAR -->
      <div class="container-fluid p-0 pt-3 pb-3">
        <div class="row g-2 align-items-center">

          <div class="col-12 col-lg-8">
            <div class="d-flex align-items-center flex-wrap gap-2">

              <p-select
                [options]="roles"
                optionLabel="label"
                optionValue="value"
                placeholder="Role"
                class="w-10rem"
                [(ngModel)]="selectedRole">
              </p-select>

              <p-select
                [options]="admins"
                optionLabel="label"
                optionValue="value"
                placeholder="Admin"
                class="w-10rem"
                [(ngModel)]="selectedAdmin">
              </p-select>

              <p-button
                icon="pi pi-filter-slash"
                severity="secondary"
                pTooltip="Clear Filters"
                (click)="clearFilters()"
                [text]="true"
                [rounded]="true" />

              <p-button
                icon="pi pi-save"
                severity="success"
                pTooltip="Save Rights"
                (click)="savePermissions()"
                [text]="true"
                [rounded]="true" />

              <p-button
                icon="pi pi-plus-circle"
                severity="secondary"
                pTooltip="Expand All"
                (click)="expandAll()"
                [text]="true"
                [rounded]="true" />

              <p-button
                icon="pi pi-minus-circle"
                severity="secondary"
                pTooltip="Collapse All"
                (click)="collapseAll()"
                [text]="true"
                [rounded]="true" />

            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- TREE TABLE -->
    <p-treeTable
      #tt
      [value]="filteredMenuMappings"
      [scrollable]="true"
      scrollHeight="420px"
      [resizableColumns]="true"
      columnResizeMode="expand"
      styleClass="shadow-1">

      <!-- HEADER -->
      <ng-template pTemplate="header">
        <tr>
          <th class="col-serial">#</th>
          <th class="col-menu">Menu</th>
          <th class="col-right">View</th>
          <th class="col-right">Insert</th>
          <th class="col-right">Update</th>
          <th class="col-right">Delete</th>
        </tr>
      </ng-template>

      <!-- BODY -->
      <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
        <tr [ttRow]="rowNode">

          <td class="col-serial">
            {{ getNodeIndex(rowNode) }}
          </td>

          <td class="col-menu">
            <div class="flex align-items-center gap-2">
              <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
              <i [class]="rowData.Icon || 'pi pi-folder'" class="text-primary"></i>
              <span class="font-medium">
                {{ rowData.MenuName }}
              </span>
            </div>
          </td>

          <td class="col-right text-center">
            <p-checkbox
              [binary]="true"
              [(ngModel)]="rowData.MRights.CanView"
              (onChange)="toggleNode(rowNode.node,'CanView',rowData.MRights.CanView)">
            </p-checkbox>
          </td>

          <td class="col-right text-center">
            <p-checkbox
              [binary]="true"
              [(ngModel)]="rowData.MRights.CanInsert"
              (onChange)="toggleNode(rowNode.node,'CanInsert',rowData.MRights.CanInsert)">
            </p-checkbox>
          </td>

          <td class="col-right text-center">
            <p-checkbox
              [binary]="true"
              [(ngModel)]="rowData.MRights.CanUpdate"
              (onChange)="toggleNode(rowNode.node,'CanUpdate',rowData.MRights.CanUpdate)">
            </p-checkbox>
          </td>

          <td class="col-right text-center">
            <p-checkbox
              [binary]="true"
              [(ngModel)]="rowData.MRights.CanDelete"
              (onChange)="toggleNode(rowNode.node,'CanDelete',rowData.MRights.CanDelete)">
            </p-checkbox>
          </td>

        </tr>
      </ng-template>

      <!-- EMPTY -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-6">
            <i class="pi pi-inbox text-4xl text-400 mb-3"></i>
            <div class="text-lg font-medium">No Menu Rights Found</div>
          </td>
        </tr>
      </ng-template>

    </p-treeTable>

  </div>
</div>
