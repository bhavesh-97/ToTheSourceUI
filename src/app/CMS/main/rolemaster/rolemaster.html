<div class="card">
  <p-table #dt 
           [value]="roles" 
           dataKey="RoleID" 
           [rows]="10" 
           [rowsPerPageOptions]="[10, 25, 50]" 
           [loading]="loading" 
           [paginator]="true" 
           [globalFilterFields]="['RoleName']" 
           [showGridlines]="true"
           styleClass="p-datatable-sm">

    <ng-template pTemplate="caption">
      <div style="display:flex; align-items:center; width:100%;">
          <h1 style="margin:0; font-size:1.75rem; font-weight:700;">Role Master</h1>
          <div style="margin-left:auto;">
              <p-button label="Add New Role" icon="pi pi-plus" class="p-button-success" (click)="openNew()">
              </p-button>
          </div>
      </div>

      <div class="flex mt-3">
        <p-iconField iconPosition="left" class="ml-auto">
          <p-inputIcon>
            <i class="pi pi-search"></i>
          </p-inputIcon>
          <input pInputText 
                 type="text" 
                 (input)="dt.filterGlobal($event.target.value, 'contains')" 
                 placeholder="Search roles..." />
        </p-iconField>
      </div>
    </ng-template>

    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        <!-- <th style="width: 3.5rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th> -->
        <th style="min-width: 16rem">
          <div class="flex align-items-center justify-content-between">
            Role Name
            <p-columnFilter type="text" field="RoleName" display="menu"></p-columnFilter>
          </div>
        </th>
        <th style="min-width: 16rem">
          <div class="flex align-items-center justify-content-between">
            Role Level
            <p-columnFilter type="text" field="RoleLevel" display="menu"></p-columnFilter>
          </div>
        </th>
        <th style="min-width: 10rem">
          <div class="flex align-items-center justify-content-between">
            Status
            <p-columnFilter field="isActive" matchMode="equals" display="menu">
              <ng-template pTemplate="filter" let-filter="filterCallback">
                <p-select [options]="[
                    { label: 'All', value: null },
                    { label: 'Active', value: true },
                    { label: 'Inactive', value: false }
                  ]" 
                  (onChange)="filter($event.value)" 
                  placeholder="All">
                </p-select>
              </ng-template>
            </p-columnFilter>
          </div>
        </th>
        <th style="width: 8rem">Actions</th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-role>
      <tr>
        <!-- <td>
          <p-tableCheckbox [value]="role"></p-tableCheckbox>
        </td> -->
        <td>
          <div class="flex align-items-center gap-3">
            <span class="font-medium">{{ role.RoleName }}</span>
          </div>
        </td>
        <td>
          <div class="flex align-items-center gap-3">
            <span class="font-medium">{{ role.RoleLevel }}</span>
          </div>
        </td>
        <td>
          <p-tag 
            [value]="role.MCommonEntitiesMaster.isActive ? 'Active' : 'Inactive'"
            [severity]="role.MCommonEntitiesMaster.isActive ? 'success' : 'danger'"
            class="text-sm">
          </p-tag>
        </td>
        <td>
          <div class="flex gap-2">
            <button pButton 
                    icon="pi pi-pencil" 
                    class="p-button-rounded p-button-text p-button-info" 
                    pTooltip="Edit" 
                    (click)="editRole(role)">
            </button>
            <button pButton 
                    icon="pi pi-trash" 
                    class="p-button-rounded p-button-text p-button-danger" 
                    pTooltip="Delete" 
                    (click)="deleteRole(role)">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Empty State -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="text-center py-6 text-600">
          <i class="pi pi-inbox text-4xl mb-3"></i>
          <div class="text-lg">No roles found</div>
          <p-button label="Add First Role" icon="pi pi-plus" class="mt-3 p-button-success" (click)="openNew()"></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<p-dialog [(visible)]="displayDialog" [header]="roleDialogHeader" [modal]="true"
          [style]="{ width: '90vw', maxWidth: '500px' }"[resizable]="true">
  <form [formGroup]="roleForm" id="roleForm" (ngSubmit)="saveRole()"> 
    <div class="container-fluid">
      <input pInputText #inputField formControlName="RoleID"  hidden/>
      <div class="row mb-3 align-items-center">
        <div class="col-8">
          <label class="form-label fw-medium mb-0">
            Role Name <span class="text-danger">*</span>
          </label>
        </div>
        <div class="col-8">
          <input pInputText
                 #inputField
                 formControlName="RoleName"
                 class="form-control input100"
                 [class.is-invalid]="roleForm.get('RoleName')?.invalid && roleForm.get('RoleName')?.touched"
                 placeholder="e.g. Administrator" />
          <div *ngIf="roleForm.get('RoleName')?.invalid && roleForm.get('RoleName')?.touched" class="invalid-feedback">
            <div *ngIf="roleForm.get('RoleName')?.errors?.['required']">Role name is required</div>
              <div *ngIf="roleForm.get('RoleName')?.errors?.['minlength']">
                Role name must be at least {{roleForm.get('RoleName')?.errors?.['minlength']?.requiredLength}} characters
              </div>
          </div>
        </div>
         <div class="col-8 mt-3 ">
          <label class="form-label fw-medium mb-0">
            Role Level <span class="text-danger">*</span>
          </label>
        </div>
        
        <div class="col-8">
          <input pInputText
              #inputField
              formControlName="RoleLevel"
              class="form-control input100"
              [class.is-invalid]="roleForm.get('RoleLevel')?.invalid && roleForm.get('RoleLevel')?.touched"
              placeholder="e.g. 1" />

            <div *ngIf="roleForm.get('RoleLevel')?.invalid && roleForm.get('RoleLevel')?.touched"class="invalid-feedback">
                <div *ngIf="roleForm.get('RoleLevel')?.errors?.['required']">
                    Role level is required
                </div>
                <div *ngIf="roleForm.get('RoleLevel')?.errors?.['min']">
                    Role level must be at least {{ roleForm.get('RoleLevel')?.errors?.['min']?.min }}
                </div>
  
                <div *ngIf="roleForm.get('RoleLevel')?.errors?.['max']">
                    Role level cannot exceed {{ roleForm.get('RoleLevel')?.errors?.['max']?.max }}
                </div>

                <div *ngIf="roleForm.get('RoleLevel')?.errors?.['pattern']">
                    Please enter a valid number
                </div>
            </div>
          </div>
        </div>
      <div class="row mb-3 align-items-center">
        <div class="col-8">
          <label class="form-label fw-medium mb-0">Status</label>
        </div>
        <div class="col-8 d-flex align-items-center gap-3" formGroupName="MCommonEntitiesMaster">
            <p-toggleswitch formControlName="isActive"></p-toggleswitch>
            <span>{{ roleForm.get('MCommonEntitiesMaster.isActive')?.value ? 'Active' : 'Inactive' }}</span>
        </div>

      </div>

    </div>
  </form>
  <ng-template pTemplate="footer">
    <button type="button" pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="displayDialog = false">
    </button>
    <button type="submit" pButton label="Save Role" icon="pi pi-check" [loading]="saving" 
            [disabled]="roleForm.invalid" class="p-button-success"form="roleForm">
    </button>
  </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
