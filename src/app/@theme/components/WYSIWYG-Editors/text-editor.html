<div class="pro-editor-container" [class.fullscreen]="isFullscreen">
  <p-toast></p-toast>
  
  <!-- Advanced Editor Component -->
  <div class="pro-editor-wrapper" 
       [style.width]="width"
       [style.height]="height"
       [style.min-height]="minHeight"
       [style.max-height]="maxHeight"
       [style.min-width]="minWidth"
       [style.max-width]="maxWidth"
       [class.dark]="isDark"
       [class.resizable]="allowResize"
       #editorContainer>
    
    <!-- Main Toolbar -->
    <!-- Main Toolbar -->
<div class="main-toolbar" *ngIf="showToolbar">
  
  <!-- Left Section - Always Visible -->
  <div class="toolbar-left">
    <!-- Basic Formatting -->
    <div class="toolbar-group">
      <button class="toolbar-btn" pTooltip="Bold (Ctrl+B)" tooltipPosition="bottom"
              [class.active]="isBold" (click)="exec('bold')">
        <i class="fa fa-bold"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Italic (Ctrl+I)" tooltipPosition="bottom"
              [class.active]="isItalic" (click)="exec('italic')">
        <i class="fa fa-italic"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Underline (Ctrl+U)" tooltipPosition="bottom"
              [class.active]="isUnderline" (click)="exec('underline')">
        <i class="fa fa-underline"></i>
      </button>
      
      <!-- Font Size - Visible on desktop, hidden on mobile (moved to overflow) -->
      <div class="toolbar-group desktop-only">
        <div class="toolbar-dropdown">
          <button class="toolbar-btn" (click)="changeFontSize(currentFontSize)" pTooltip="Font Size">
            <span class="font-size-label">{{currentFontSize.label}}</span>
            <i class="fa fa-chevron-down ml-1"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Alignment -->
    <div class="toolbar-group desktop-only">
      <button class="toolbar-btn" pTooltip="Align Left" (click)="changeAlignment('left')"
              [class.active]="currentAlignment === 'left'">
        <i class="fa fa-align-left"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Align Center" (click)="changeAlignment('center')"
              [class.active]="currentAlignment === 'center'">
        <i class="fa fa-align-center"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Align Right" (click)="changeAlignment('right')"
              [class.active]="currentAlignment === 'right'">
        <i class="fa fa-align-right"></i>
      </button>
    </div>
  </div>
  
  <!-- Center Section - Hidden on mobile -->
  <div class="toolbar-center desktop-only">
    <!-- Lists -->
    <div class="toolbar-group">
      <button class="toolbar-btn" pTooltip="Bulleted List" (click)="exec('insertUnorderedList')">
        <i class="fa fa-list-ul"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Numbered List" (click)="exec('insertOrderedList')">
        <i class="fa fa-list-ol"></i>
      </button>
    </div>
    
    <!-- Colors -->
    <div class="toolbar-group">
      <p-colorPicker [(ngModel)]="textColor" (onChange)="exec('foreColor', textColor)" 
                    class="color-picker-btn" pTooltip="Text Color">
        <div class="color-icon" [style.color]="textColor">
          <i class="fa fa-font"></i>
        </div>
      </p-colorPicker>
      
      <p-colorPicker [(ngModel)]="bgColor" (onChange)="exec('backColor', bgColor)" 
                    class="color-picker-btn" pTooltip="Background Color">
        <div class="color-icon" [style.background]="bgColor">
          <i class="fa fa-fill-drip"></i>
        </div>
      </p-colorPicker>
    </div>
  </div>
  
  <!-- Right Section -->
  <div class="toolbar-right">
    <!-- Essential Actions - Always Visible -->
    <div class="toolbar-group">
      <button class="toolbar-btn" pTooltip="Insert Link (Ctrl+K)" (click)="showLink = true">
        <i class="fa fa-link"></i>
      </button>
      <button class="toolbar-btn" pTooltip="Insert Image" (click)="showImage = true">
        <i class="fa fa-image"></i>
      </button>
      <button class="toolbar-btn desktop-only" pTooltip="Undo (Ctrl+Z)" (click)="undo()">
        <i class="fa fa-undo"></i>
      </button>
      <button class="toolbar-btn desktop-only" pTooltip="Redo (Ctrl+Y)" (click)="redo()">
        <i class="fa fa-redo"></i>
      </button>
    </div>
    
    <!-- View Controls -->
    <div class="toolbar-group">
      <button class="toolbar-btn" pTooltip="Toggle Theme" (click)="toggleTheme()">
        <i class="fa" [class.fa-moon]="!isDark" [class.fa-sun]="isDark"></i>
      </button>
      
      <button class="toolbar-btn" pTooltip="Fullscreen (F11)" (click)="toggleFullscreen()"
              *ngIf="allowFullscreen">
        <i class="fa" [class.fa-expand]="!isFullscreen" [class.fa-compress]="isFullscreen"></i>
      </button>
      
      <!-- Overflow Menu Button - Visible on mobile and when needed -->
      <div class="overflow-menu-container" [class.mobile-only]="isMobileView">
        <button class="toolbar-btn overflow-btn" 
                pTooltip="More Options"
                (click)="showOverflowMenu = !showOverflowMenu">
          <i class="fa fa-ellipsis-h"></i>
        </button>
        
        <!-- Overflow Dropdown Menu -->
        <div class="overflow-menu" *ngIf="showOverflowMenu" @fadeInOut>
          <div class="overflow-menu-content">
            <button *ngFor="let item of overflowMenuItems" 
                    class="overflow-menu-item"
                    (click)="item.command ? item.command() : null"
                    [class.separator]="item.separator">
              <i *ngIf="item.icon" [class]="item.icon"></i>
              <span>{{item.label}}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    <!-- Editor Area -->
    <div class="editor-area">
      <div #editor 
           contenteditable="true" 
           class="editor-content" 
           [class.source-mode]="isSource"
           [class.readonly]="isReadOnly"
           (blur)="onBlur()"
           (focus)="editorFocus.emit()"
           [attr.placeholder]="placeholder"
           [attr.aria-label]="placeholder">
      </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar" *ngIf="showStatusBar">
      <div class="status-item">
        <i class="fa fa-font"></i>
        <span>{{charCount}} chars</span>
      </div>
      <div class="status-item">
        <i class="fa fa-file-word"></i>
        <span>{{wordCount}} words</span>
      </div>
      <div class="status-item">
        <i class="fa fa-clock"></i>
        <span>{{readingTime}} min read</span>
      </div>
      <div class="status-item">
        <i class="fa fa-paragraph"></i>
        <span>{{paragraphCount}} paragraphs</span>
      </div>
      <div class="status-item" *ngIf="lastSaved">
        <i class="fa fa-save"></i>
        <span>Saved {{lastSaved | date:'shortTime'}}</span>
      </div>
      <div class="status-item mode-indicator">
        <span>{{isSource ? 'Source Mode' : 'Rich Text'}}</span>
      </div>
    </div>
    
    <!-- Resize Handle -->
    <div class="resize-handle" #resizeHandle *ngIf="allowResize && !isFullscreen">
      <i class="fa fa-grip-lines-vertical"></i>
    </div>
  </div>
  
  <!-- All Dialogs -->
  
  <!-- Font Dialog -->
  <p-dialog header="Font Settings" [(visible)]="showFontDialog" [modal]="true" [style]="{width: '450px'}">
    <div class="dialog-content">
      <div class="form-row">
        <div class="form-group">
          <label>Font Family</label>
          <p-select [options]="fontOptions" [(ngModel)]="currentFont" optionLabel="label"></p-select>
        </div>
        
        <div class="form-group">
          <label>Font Size</label>
          <p-select [options]="fontSizeOptions" [(ngModel)]="currentFontSize" optionLabel="label"></p-select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Heading</label>
          <p-select [options]="headingOptions" [(ngModel)]="currentHeading" optionLabel="label"></p-select>
        </div>
        
        <div class="form-group">
          <label>Line Height: {{currentLineHeight}}</label>
          <input type="range" [(ngModel)]="currentLineHeight" min="1" max="3" step="0.1" class="line-height-slider">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Text Alignment</label>
          <div class="alignment-buttons">
            <button *ngFor="let align of alignmentOptions" 
                    class="align-btn" 
                    [class.active]="currentAlignment === align.value"
                    (click)="changeAlignment(align.value)"
                    [title]="align.label">
              <i class="fa" [ngClass]="align.icon"></i>
            </button>
          </div>
        </div>
      </div>
      
      <div class="dialog-actions">
        <button pButton label="Apply" icon="fa fa-check" (click)="changeFont(currentFont); showFontDialog = false;" 
                class="p-button-success"></button>
        <button pButton label="Cancel" icon="fa fa-times" (click)="showFontDialog = false" 
                class="p-button-secondary"></button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Link Dialog -->
  <p-dialog header="Insert Link" [(visible)]="showLink" [modal]="true" [style]="{width: '500px'}">
    <div class="dialog-content">
      <div class="form-group">
        <label>Display Text</label>
        <input pInputText [(ngModel)]="linkText" placeholder="Link text (optional)" class="w-full">
      </div>
      <div class="form-group">
        <label>URL *</label>
        <input pInputText [(ngModel)]="linkUrl" placeholder="https://example.com" class="w-full">
      </div>
      <div class="form-group">
        <label>Title (Tooltip)</label>
        <input pInputText [(ngModel)]="linkTitle" placeholder="Link title (optional)" class="w-full">
      </div>
      <div class="form-row">
        <div class="form-group">
          <p-checkbox [(ngModel)]="linkNewTab" label="Open in new tab"></p-checkbox>
        </div>
        <div class="form-group">
          <p-checkbox [(ngModel)]="linkNoFollow" label="No follow"></p-checkbox>
        </div>
      </div>
      <div class="dialog-actions">
        <button pButton label="Insert Link" icon="fa fa-link" (click)="insertLink()" class="p-button-success"></button>
        <button pButton label="Cancel" icon="fa fa-times" (click)="showLink=false" class="p-button-secondary"></button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Image Dialog -->
  <p-dialog header="Upload Image" [(visible)]="showImage" [modal]="true" [style]="{width: '500px'}">
    <div class="dialog-content">
      <p-fileUpload mode="advanced" name="images[]" [multiple]="false" accept="image/*" 
                    maxFileSize="10000000" chooseLabel="Select Image" uploadLabel="Upload"
                    cancelLabel="Cancel" (onSelect)="uploadImage($event.files[0])">
        <ng-template pTemplate="content">
          <div class="upload-info">
            <p><i class="fa fa-info-circle"></i> Supported formats: JPG, PNG, GIF, WebP, SVG</p>
            <p><i class="fa fa-info-circle"></i> Maximum file size: 10MB</p>
            <p><i class="fa fa-info-circle"></i> You can also drag & drop images directly into the editor</p>
          </div>
        </ng-template>
      </p-fileUpload>
    </div>
  </p-dialog>
  
  <!-- Table Dialog -->
  <p-dialog header="Insert Table" [(visible)]="showTableConfig" [modal]="true" [style]="{width: '500px'}">
    <div class="dialog-content">
      <div class="form-row">
        <div class="form-group">
          <label>Rows</label>
          <p-inputNumber [(ngModel)]="tableConfig.rows" [min]="1" [max]="20" [showButtons]="true"></p-inputNumber>
        </div>
        <div class="form-group">
          <label>Columns</label>
          <p-inputNumber [(ngModel)]="tableConfig.cols" [min]="1" [max]="10" [showButtons]="true"></p-inputNumber>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Cell Padding</label>
          <p-inputNumber [(ngModel)]="tableConfig.cellPadding" [min]="0" [max]="20" [showButtons]="true"></p-inputNumber>
        </div>
      </div>
      <div class="form-row checkbox-group">
        <div class="form-group">
          <p-checkbox [(ngModel)]="tableConfig.header" label="Include header row"></p-checkbox>
        </div>
        <div class="form-group">
          <p-checkbox [(ngModel)]="tableConfig.border" label="Show borders"></p-checkbox>
        </div>
        <div class="form-group">
          <p-checkbox [(ngModel)]="tableConfig.striped" label="Alternate row colors"></p-checkbox>
        </div>
      </div>
      <div class="table-preview">
        <table [class.bordered]="tableConfig.border" [class.striped]="tableConfig.striped">
          <thead *ngIf="tableConfig.header">
            <tr>
              <th *ngFor="let col of [].constructor(tableConfig.cols); let i = index">Header {{i+1}}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of [].constructor(tableConfig.rows); let r = index">
              <td *ngFor="let col of [].constructor(tableConfig.cols); let c = index">Cell {{r+1}}-{{c+1}}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="dialog-actions">
        <button pButton label="Insert Table" icon="fa fa-table" (click)="insertTable()" class="p-button-success"></button>
        <button pButton label="Cancel" icon="fa fa-times" (click)="showTableConfig=false" class="p-button-secondary"></button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Code Dialog -->
  <p-dialog header="Insert Code" [(visible)]="showCodeDialog" [modal]="true" [style]="{width: '600px'}">
    <div class="dialog-content">
      <div class="form-group">
        <label>Language</label>
        <select class="form-select" [(ngModel)]="codeLanguage">
          <option value="html">HTML</option>
          <option value="css">CSS</option>
          <option value="javascript">JavaScript</option>
          <option value="typescript">TypeScript</option>
          <option value="json">JSON</option>
          <option value="xml">XML</option>
          <option value="sql">SQL</option>
          <option value="python">Python</option>
          <option value="java">Java</option>
          <option value="csharp">C#</option>
          <option value="php">PHP</option>
          <option value="plain">Plain Text</option>
        </select>
      </div>
      <div class="form-group">
        <label>Code</label>
        <textarea pInputTextarea [(ngModel)]="codeContent" rows="12" class="w-full code-textarea" 
                  placeholder="Paste your code here..."></textarea>
      </div>
      <div class="dialog-actions">
        <button pButton label="Insert Code" icon="fa fa-code" (click)="insertCode()" class="p-button-success"></button>
        <button pButton label="Cancel" icon="fa fa-times" (click)="showCodeDialog=false" class="p-button-secondary"></button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Emoji Dialog -->
  <p-dialog header="Insert Emoji" [(visible)]="showEmojiPicker" [modal]="true" [style]="{width: '550px', maxHeight: '600px'}">
    <div class="dialog-content">
      <div class="emoji-categories">
        <button *ngFor="let category of emojiCategories" 
                class="category-btn"
                [class.active]="selectedCategory === category.name"
                (click)="selectedCategory = category.name">
          <i class="fa" [ngClass]="category.icon"></i>
          <span>{{category.name}}</span>
        </button>
      </div>
      <div class="emoji-grid">
        <button *ngFor="let emoji of getEmojisByCategory(selectedCategory)" 
                class="emoji-btn" 
                (click)="insertEmoji(emoji.emoji)"
                [title]="emoji.description">
          {{emoji.emoji}}
        </button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Special Characters Dialog -->
  <p-dialog header="Insert Special Character" [(visible)]="showSpecialChars" [modal]="true" [style]="{width: '550px'}">
    <div class="dialog-content">
      <div class="special-chars-grid">
        <button *ngFor="let char of specialCharacters" 
                class="char-btn" 
                (click)="insertSpecialChar(char)"
                [title]="getCharName(char)">
          {{char}}
        </button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Settings Dialog -->
  <p-dialog header="Editor Settings" [(visible)]="showSettingsDialog" [modal]="true" [style]="{width: '500px'}">
    <div class="dialog-content">
      <div class="form-group">
        <label>Auto-save</label>
        <p-checkbox [(ngModel)]="autoSave"></p-checkbox>
      </div>
      <div class="form-group" *ngIf="autoSave">
        <label>Auto-save Interval (seconds)</label>
        <p-inputNumber [(ngModel)]="autoSaveInterval" [min]="5" [max]="300" suffix=" sec"></p-inputNumber>
      </div>
      <div class="form-group">
        <label>Maximum Undo Steps</label>
        <p-inputNumber [(ngModel)]="maxUndoSteps" [min]="10" [max]="100"></p-inputNumber>
      </div>
      <div class="form-group">
        <label>Default Font Size</label>
        <p-select [options]="fontSizeOptions" [(ngModel)]="currentFontSize" optionLabel="label"></p-select>
      </div>
      <div class="dialog-actions">
        <button pButton label="Save Settings" icon="fa fa-save" (click)="showSettingsDialog = false" 
                class="p-button-success"></button>
        <button pButton label="Cancel" icon="fa fa-times" (click)="showSettingsDialog = false" 
                class="p-button-secondary"></button>
      </div>
    </div>
  </p-dialog>
  
  <!-- Preview Dialog -->
  <p-dialog header="Preview" [(visible)]="showPreviewDialog" [modal]="true" 
            [style]="{width: '90vw', height: '90vh'}" [maximizable]="true">
    <div class="preview-content" [innerHTML]="content"></div>
  </p-dialog>
  
  <!-- History Dialog -->
  <p-dialog header="History" [(visible)]="showHistoryDialog" [modal]="true" [style]="{width: '700px', height: '500px'}">
    <div class="history-content">
      <div class="history-list">
        <div *ngFor="let item of history; let i = index" 
             class="history-item" 
             [class.active]="i === currentHistoryIndex"
             (click)="restoreFromHistory(i)">
          <div class="history-time">{{item.timestamp | date:'medium'}}</div>
          <div class="history-preview">{{item.content | slice:0:100}}...</div>
        </div>
      </div>
    </div>
  </p-dialog>
</div>